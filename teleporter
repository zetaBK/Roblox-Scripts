local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")

local lp = Players.LocalPlayer
local TARGET_NAME = "GJ0BY"
local DIST_AHEAD = 3
local HEIGHT = 2

local enabledTP = false
local tpConn = nil

local function getCharParts()
	local char = lp.Character
	if not char then return nil end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	local hum = char:FindFirstChildOfClass("Humanoid")
	return char, hrp, hum
end

local function getTargetHRP()
	local target = Players:FindFirstChild(TARGET_NAME)
	if not target then return nil end
	local ch = target.Character
	if not ch then return nil end
	return ch:FindFirstChild("HumanoidRootPart")
end

local function stopTP()
	if tpConn then
		tpConn:Disconnect()
		tpConn = nil
	end
end

local function startTP()
	stopTP()
	local _, hrp, hum = getCharParts()
	if not hrp or not hum then return end

	tpConn = RS.Heartbeat:Connect(function()
		if not enabledTP then return end
		local _, hrpNow, humNow = getCharParts()
		if not hrpNow or not humNow then return end
		local targetHRP = getTargetHRP()
		if not targetHRP then return end

		local offset = targetHRP.CFrame.LookVector * DIST_AHEAD + Vector3.new(0, HEIGHT, 0)
		pcall(function()
			hrpNow.CFrame = CFrame.new(targetHRP.Position + offset, targetHRP.Position)
			humNow.PlatformStand = false
		end)
	end)
end

local function setEnabled(on)
	enabledTP = on
	if enabledTP then
		startTP()
	else
		stopTP()
	end
end

-- Restart teleport loop immediately on respawn, waiting for HumanoidRootPart to exist
lp.CharacterAdded:Connect(function(character)
	if not enabledTP then return end
	local hrp = character:WaitForChild("HumanoidRootPart", 10)
	if hrp then
		startTP()
	end
end)

-- Anti-AFK loop to keep player active continuously
task.spawn(function()
	while true do
		pcall(function()
			VirtualUser:CaptureController()
			VirtualUser:ClickButton2(Vector2.new(0, 0))
		end)
		task.wait(0.1)
	end
end)

-- Start teleporting initially disabled
setEnabled(false)

-- GUI Creation: simple black draggable box labeled "TP"
local gui = Instance.new("ScreenGui")
gui.Name = "SimpleTPGui"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = game.CoreGui

local root = Instance.new("Frame")
root.Name = "Root"
root.Size = UDim2.new(0, 100, 0, 40)
root.Position = UDim2.new(0, 20, 0, 100)
root.BackgroundColor3 = Color3.new(0, 0, 0)
root.BorderSizePixel = 0
root.Parent = gui

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "TP"
label.Font = Enum.Font.GothamBold
label.TextSize = 20
label.TextColor3 = Color3.new(1, 1, 1)
label.Parent = root

local toggle = Instance.new("TextButton")
toggle.Size = UDim2.new(1, 0, 1, 0)
toggle.BackgroundTransparency = 1
toggle.Text = ""
toggle.Parent = root

local dragging = false
local dragStartPos = Vector2.new()
local startPos = UDim2.new()

local function inputPos(input)
	return Vector2.new(input.Position.X, input.Position.Y)
end

toggle.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStartPos = inputPos(input)
		startPos = root.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

UIS.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = inputPos(input) - dragStartPos
		root.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
end)

toggle.Activated:Connect(function()
	setEnabled(not enabledTP)
	label.TextColor3 = enabledTP and Color3.new(0, 1, 0) or Color3.new(1, 1, 1)
end)
