local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")

local localPlayer = Players.LocalPlayer
local TARGET_NAME = "GJ0BY" -- Change this to your target player name
local DISTANCE_AHEAD = 3
local HEIGHT_OFFSET = 2

local teleportEnabled = false
local teleportConnection = nil

-- Get character parts safely
local function getCharacterParts()
	local character = localPlayer.Character
	if not character then return nil end
	local hrp = character:FindFirstChild("HumanoidRootPart")
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	if hrp and humanoid then
		return character, hrp, humanoid
	end
	return nil
end

-- Get target player's HumanoidRootPart safely
local function getTargetHRP()
	local targetPlayer = Players:FindFirstChild(TARGET_NAME)
	if not targetPlayer then return nil end
	local targetChar = targetPlayer.Character
	if not targetChar then return nil end
	return targetChar:FindFirstChild("HumanoidRootPart")
end

-- Stop teleport loop safely
local function stopTeleport()
	if teleportConnection then
		teleportConnection:Disconnect()
		teleportConnection = nil
	end
end

-- Start teleport loop safely
local function startTeleport()
	stopTeleport()
	local _, hrp, humanoid = getCharacterParts()
	if not hrp or not humanoid then return end

	teleportConnection = RunService.Heartbeat:Connect(function()
		if not teleportEnabled then return end
		local _, currentHRP, currentHumanoid = getCharacterParts()
		if not currentHRP or not currentHumanoid then return end
		local targetHRP = getTargetHRP()
		if not targetHRP then return end

		local offset = targetHRP.CFrame.LookVector * DISTANCE_AHEAD + Vector3.new(0, HEIGHT_OFFSET, 0)
		pcall(function()
			currentHRP.CFrame = CFrame.new(targetHRP.Position + offset, targetHRP.Position)
			currentHumanoid.PlatformStand = false
		end)
	end)
end

-- Enable or disable teleporting
local function setTeleportEnabled(state)
	teleportEnabled = state
	if teleportEnabled then
		startTeleport()
	else
		stopTeleport()
	end
end

-- On character respawn, wait for HumanoidRootPart then restart teleport loop if enabled
localPlayer.CharacterAdded:Connect(function(character)
	if not teleportEnabled then return end
	local hrp = character:WaitForChild("HumanoidRootPart", 10)
	if hrp then
		startTeleport()
	end
end)

-- Anti-AFK loop to keep player active continuously
task.spawn(function()
	while true do
		pcall(function()
			VirtualUser:CaptureController()
			VirtualUser:ClickButton2(Vector2.new(0, 0))
		end)
		task.wait(0.1)
	end
end)

-- Start disabled by default
setTeleportEnabled(false)

-- GUI: simple black draggable box labeled "TP"
local gui = Instance.new("ScreenGui")
gui.Name = "TeleportToggleGui"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = game.CoreGui

local frame = Instance.new("Frame")
frame.Name = "MainFrame"
frame.Size = UDim2.new(0, 100, 0, 40)
frame.Position = UDim2.new(0, 20, 0, 100)
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.BorderSizePixel = 0
frame.Parent = gui

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "TP"
label.Font = Enum.Font.GothamBold
label.TextSize = 20
label.TextColor3 = Color3.new(1, 1, 1)
label.Parent = frame

local button = Instance.new("TextButton")
button.Size = UDim2.new(1, 0, 1, 0)
button.BackgroundTransparency = 1
button.Text = ""
button.Parent = frame

local dragging = false
local dragStartPos = Vector2.new()
local frameStartPos = UDim2.new()

local function getInputPosition(input)
	return Vector2.new(input.Position.X, input.Position.Y)
end

button.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStartPos = getInputPosition(input)
		frameStartPos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = getInputPosition(input) - dragStartPos
		frame.Position = UDim2.new(
			frameStartPos.X.Scale,
			frameStartPos.X.Offset + delta.X,
			frameStartPos.Y.Scale,
			frameStartPos.Y.Offset + delta.Y
		)
	end
end)

button.Activated:Connect(function()
	setTeleportEnabled(not teleportEnabled)
	label.TextColor3 = teleportEnabled and Color3.new(0, 1, 0) or Color3.new(1, 1, 1)
end)
